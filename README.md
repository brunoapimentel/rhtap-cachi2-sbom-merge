# Merging Cachi2 reported components into RHTAP SBOMs

The goal of this case study is to find out the differences in the way that Syft and Cachi2 report
the same components, so that proper deduplication can be done.

Check the contents of the [find-duplicates](./find-duplicates.ipynb) script to see an analysis of each 
sample repository present in this study. 

## How the SBOMs were generated?

- Cachi2: Clone the repository, checkout to specific commit, process it with Cachi2
- RHTAP: Import the repository in RHTAP, set the specific commit, build it and fetch the resulting SBOM
- Merged: Generated by merging both SBOMs (Cachi2 and RHTAP) with the cachi2/utils/merge_syft_sbom.py script

## Main differences in reported components from Cachi2 and Syft

### Golang
- Cachi2 reports packages, Syft only reports modules
- Cachi2 adds a type=module|package qualifier to components
- Cachi2 normalizes the purls for local dependency replacements
- Cachi2 reports in the purl the real location to the main module, not only the name mentioned in the go.mod file
- Cachi2 encodes special characters in purl qualifiers and subpaths

### Pip

- Cachi2 properly reports the dependencies resolved from VCS

###


## Main differences in purls from Cachi2 and Syft

## Golang main module
Cachi2: `pkg:golang/github.com/redhat-appstudio/build-service@v0.0.0-20230503110830-d1a9e858489d?type=module`

Syft: `pkg:golang/github.com/redhat-appstudio/build-service@(devel)`

### Golang local replacements
Cachi2: `pkg:golang/github.com/cachito-testing/gomod-pandemonium/terminaltor@v1.0.0?type=module`

Syft: `pkg:golang/./terminaltor`

## Golang with special characters in the version
Cachi2: `pkg:golang/github.com/docker/cli@v23.0.0-rc.3%2Bincompatible?type=module`

Syft: `pkg:golang/github.com/docker/cli@v23.0.0-rc.3+incompatible`

## NPM non-registry dependency
Cachi2: `pkg:npm/fecha?checksum=sha512:8ae71e98d68e38e1f6e4c629187684dd85e4dc96647c7219b1dd189598ea52865e947f0ad94a7001fa8fb5eccf58467fe34ad10066e831af3374120134604bd5&download_url=https://github.com/taylorhakes/fecha/archive/91680e4db1415fea33eac878cfd889c80a7b55c7.tar.gz`

Syft: `pkg:npm/fecha@https://github.com/taylorhakes/fecha/archive/91680e4db1415fea33eac878cfd889c80a7b55c7.tar.gz`

## Pip non-registry dependency
Cachi2: `pkg:pypi/appr?checksum=sha256:ee6a0a38bed8cff46a562ed3620bc453141a02262ab0c8dd055824af2829ee5c&download_url=https://github.com/quay/appr/archive/37ff9a487a54ad41b59855ecd76ee092fe206a84.zip`

Syft: `pkg:pypi/appr@0.7.4`